<!DOCTYPE html>
<html>
    <head>
        <link rel='stylesheet' href='/components/bootstrap/dist/css/bootstrap.css' />
        <link rel='stylesheet' href='/stylesheets/style.css' />
        <link rel='stylesheet' href='/stylesheets/hand.css' />
		
        <script src='/components/zepto/zepto.js'></script>
        <script>
            // quick fix for jquery hammerjs plugin
            jQuery = Zepto;
        </script>

        <script src="/socket.io/socket.io.js"></script>
        <script src="/components/hammerjs/hammer.js"></script>
        <script src="/components/jquery-hammerjs/jquery.hammer.js"></script>

        <script>
            $(function() {
                var socket = io.connect('http://192.168.137.91:3000');
                socket.on('news', function (data) {
                    console.log(data);
                    //socket.emit('my other event', { my: 'data' });
                });

                $('#test-button').on('click', function(event) {
                    socket.emit('button', { page: 'hand' });
                });
				
				var xStart, yStart = 0;
 
				document.addEventListener('touchstart',function(e) {
					xStart = e.touches[0].screenX;
					yStart = e.touches[0].screenY;
				});
 
				document.addEventListener('touchmove',function(e) {
					var xMovement = Math.abs(e.touches[0].screenX - xStart);
					var yMovement = Math.abs(e.touches[0].screenY - yStart);
					if((yMovement * 3) > xMovement) {
						e.preventDefault();
					}
				});
				
				function addCard(card) {
					var div = $('<div></div>', {class: 'card', id: card.id});
					var img = $('<img />', {src: card.src});
					div.append(img);
					$("#hand").append(div);
					
					var card = document.getElementById(card.id);
					var hammer = new Hammer(card, {});
					hammer.get('pan').set({ direction: Hammer.DIRECTION_VERTICAL });
                    hammer.get('swipe').set({ enable: false });
                    hammer.get('pinch').set({ enable: false });
                    hammer.get('rotate').set({ enable: false });

                    hammer.on('tap', function(ev) {
                        socket.emit('card-tapped', { id: card.id });
                    });
                    hammer.on('panup', function(ev) {
						$(card).removeClass('end');
                        var transform = 'translateY(' + ev.deltaY + 'px)';
                        card.style.transform = transform;
                        card.style.oTransform = transform;
                        card.style.msTransform = transform;
                        card.style.mozTransform = transform;
                        card.style.webkitTransform = transform;
                        console.log('up ' + card.id + ' of ' + transform);
						if(ev.deltaY <= -screen.height/2) {
							socket.emit('card-played', { card: card });
						}
                    });
                    hammer.on('pandown', function(ev) {
						$(card).removeClass('end');
                        var transform = 'translateY(' + ev.deltaY + 'px)';
                        card.style.transform = transform;
                        card.style.oTransform = transform;
                        card.style.msTransform = transform;
                        card.style.mozTransform = transform;
                        card.style.webkitTransform = transform;
                        console.log('down ' + card.id + ' of ' + transform);
						if(ev.deltaY >= screen.height/2) {
							socket.emit('card-discared', { card: card });
						}
                    });
					hammer.on('panend', function(ev) {
						$(card).addClass('end');
						console.log('release ' + card.id);
						var transform = 'translateY(' + 0 + 'px)';
						card.style.transform = transform;
                        card.style.oTransform = transform;
                        card.style.msTransform = transform;
                        card.style.mozTransform = transform;
                        card.style.webkitTransform = transform;
                    });
				}
				
				function removeCard(card) {
					$('#' + card.id).remove();
				}
				
				for (i = 1; i <= 10; i++) {
					addCard({id: i, src: 'pictures/card' + i + '.jpg', alt:'Photo de la carte ' + i});
				}
				
                /*var cards = document.getElementsByClassName('card');
                Array.prototype.forEach.call(cards, function (card) {

                    var hammer = new Hammer(card, {});

                    //hammer.get('pan').set({ enable: false });
                    hammer.get('pan').set({ direction: Hammer.DIRECTION_VERTICAL });
                    hammer.get('swipe').set({ enable: false });
                    hammer.get('pinch').set({ enable: false });
                    hammer.get('rotate').set({ enable: false });

                    hammer.on('tap', function(ev) {
                        socket.emit('card-tapped', { id: card.id });
                    });
                    hammer.on('panup', function(ev) {
						$(card).removeClass('end');
                        var transform = 'translateY(' + ev.deltaY + 'px)';
                        card.style.transform = transform;
                        card.style.oTransform = transform;
                        card.style.msTransform = transform;
                        card.style.mozTransform = transform;
                        card.style.webkitTransform = transform;
                        console.log('up ' + card.id + ' of ' + transform);
						if(ev.deltaY <= -screen.height/2) {
							socket.emit('card-played', { id: card.id });
						}
                    });
                    hammer.on('pandown', function(ev) {
						$(card).removeClass('end');
                        var transform = 'translateY(' + ev.deltaY + 'px)';
                        card.style.transform = transform;
                        card.style.oTransform = transform;
                        card.style.msTransform = transform;
                        card.style.mozTransform = transform;
                        card.style.webkitTransform = transform;
                        console.log('down ' + card.id + ' of ' + transform);
						if(ev.deltaY >= screen.height/2) {
							socket.emit('card-discared', { id: card.id });
						}
                    });
					hammer.on('panend', function(ev) {
						$(card).addClass('end');
						console.log('release ' + card.id);
						var transform = 'translateY(' + 0 + 'px)';
						card.style.transform = transform;
                        card.style.oTransform = transform;
                        card.style.msTransform = transform;
                        card.style.mozTransform = transform;
                        card.style.webkitTransform = transform;
                    });*/
                    /*hammer.on('panleft', function(ev) {
                        console.log('left ' + card.id);
                    });
                    hammer.on('panright', function(ev) {
                        console.log('right ' + card.id);
                    });*/
                /*});*/

            })
        </script>
    </head>
    <body>
        <div id="horizontal-wrap">
            <div id="page-wrap">
                <div class="container-fluid">
                    <!--<button id="test-button" type="button" class="btn btn-default">Default</button>-->
                    <div id="hand">
                        <!--<div class="card" id="1">
							<img src="pictures/card1.jpg" alt="Photo de la carte 1" />
                        </div>
                        <div class="card" id="2">
							<img src="pictures/card2.jpg" alt="Photo de la carte 2" />
                        </div>
                        <div class="card" id="3">
							<img src="pictures/card3.jpg" alt="Photo de la carte 3" />
                        </div>
                        <div class="card" id="4">
							<img src="pictures/card4.jpg" alt="Photo de la carte 4" />
                        </div>
                        <div class="card" id="5">
							<img src="pictures/card5.jpg" alt="Photo de la carte 5" />
                        </div>
                        <div class="card" id="6">
							<img src="pictures/card6.jpg" alt="Photo de la carte 6" />
                        </div>
                        <div class="card" id="7">
							<img src="pictures/card7.jpg" alt="Photo de la carte 7" />
                        </div>
                        <div class="card" id="8">
							<img src="pictures/card8.jpg" alt="Photo de la carte 8" />
                        </div>
                        <div class="card" id="9">
							<img src="pictures/card9.jpg" alt="Photo de la carte 9" />
                        </div>
                        <div class="card" id="10">
							<img src="pictures/card10.jpg" alt="Photo de la carte 10" />
                        </div>-->
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>